:root{
  --bg:#f6f8fc; --panel:#fff; --text:#0f172a; --muted:#52607a; --border:#e6e9f2;
  --accent:#2563eb; --accent-200:#cfe0ff; --shadow:0 4px 10px rgba(10,16,28,.06);
  --ok:#10b981; --below:#f59e0b; --over:#ef4444; --chip:#eef3ff;
}

/* Reset / base */
*{ box-sizing:border-box }
body{ margin:0; background:var(--bg); color:var(--text); font:15px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial }

/* ===== Layout / Sidebar ===== */
.app{ display:grid; grid-template-columns:72px 1fr; min-height:100vh }
.side{
  position:sticky; top:0; height:100vh;
  background:linear-gradient(180deg,#0b1224,#0f1933);
  display:flex; flex-direction:column; align-items:center; padding:14px 10px; gap:12px
}
.logo{
  width:42px; height:42px; border-radius:12px; background:#1b2a55;
  display:grid; place-items:center; color:#cfe0ff; font-weight:800; margin:2px 0 10px;
  border:1px solid rgba(255,255,255,.08)
}
.icon-btn{
  position:relative; width:52px; height:52px; border-radius:14px;
  border:1px solid rgba(255,255,255,.08); background:rgba(255,255,255,.05);
  display:grid; place-items:center; color:#e3ecff; cursor:pointer;
  transition:.18s transform,.18s background,.18s box-shadow
}
.icon-btn:hover{ transform:translateX(5px); background:rgba(255,255,255,.1) }
.icon-btn.active{
  background:linear-gradient(135deg,#662D91,#F15A29); border-color:transparent;
  box-shadow:0 0 0 2px rgba(241,90,41,.25) inset
}
.icon-btn .label{
  position:absolute; left:60px; top:50%; transform:translate(0,-50%) translateX(-8px);
  opacity:0; pointer-events:none; white-space:nowrap; background:#0f172a; color:#e6f0ff;
  border:1px solid #29407d; padding:7px 12px; border-radius:10px; box-shadow:0 6px 24px rgba(0,0,0,.3);
  transition:.18s; font-size:13px
}
.icon-btn:hover .label{ opacity:1; transform:translate(0,-50%) translateX(0) }
.side .spacer{ flex:1 }

/* ===== Top bar ===== */
header.top{
  position:sticky; top:0; z-index:2;
  background:linear-gradient(90deg,#662D91 0%, #F15A29 100%); color:#fff;
  border-bottom:0; padding:14px 20px; display:flex; align-items:center; gap:14px
}
.top-title{ font-weight:900; font-size:18px }
.badge{ font-size:13px; border:1px solid var(--border); padding:6px 10px; border-radius:999px; background:#fff; color:var(--muted) }

/* ===== Main / Cards ===== */
main{ padding:18px; display:flex; flex-direction:column; gap:18px; width:100%; max-width:none }
.card{ background:var(--panel); border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow) }
.card header{ padding:14px 16px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; gap:10px }
.card .body{ padding:16px }

/* ===== Forms ===== */
.field{ display:flex; flex-direction:column; gap:6px }
.field label{ font-size:12px; color:var(--muted); font-weight:600 }
.field input,.field select,.field textarea{
  padding:12px 14px; border:1.5px solid var(--border); border-radius:12px; font:inherit; background:#fff;
  box-shadow:inset 0 1px 0 rgba(16,24,40,.02)
}
.field input:focus,.field select:focus,.field textarea:focus{
  outline:none; border-color:#c7d6ff; box-shadow:0 0 0 4px rgba(37,99,235,.08)
}
.row{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px }
.row-3{ display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:12px }
.narrow{ max-width:none; width:100% }

/* ===== Buttons / Pills ===== */
.btn{
  appearance:none; border:1px solid #e6e8f0; background:#fff; border-radius:9999px;
  padding:10px 14px; font-size:14px; line-height:1; cursor:pointer
}
.btn:disabled{ opacity:.5; cursor:not-allowed }
.btn.primary{
  background:linear-gradient(90deg,#662D91,#F15A29); color:#fff; border-color:transparent;
  box-shadow:0 6px 18px rgba(101,45,145,.25)
}
.btn.danger.outline{ background:#fff4f4; border-color:#f8c6c6; color:#c62828 }
.mini{
  appearance:none; border:1px solid #e6e8f0; background:#fff; border-radius:9999px;
  padding:5px 8px; font-size:12px; line-height:1; cursor:pointer
}
.mini.danger{ background:#fff4f4; border-color:#f7c2c2; color:#c62828 }

/* segmented control */
.seg{ display:inline-flex; padding:4px; background:#f4f6fb; border:1px solid #e6e8f0; border-radius:9999px }
.seg>button{ border:0; background:transparent; padding:6px 10px; border-radius:9999px; cursor:pointer; font:inherit }
.seg>button.active{ background:#0f1629; color:#fff }

/* select-all pill */
.sel-all{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border:1px solid #e6e8f0; border-radius:9999px; background:#fff; user-select:none }

/* chips row */
.chips .chip{
  display:inline-block; padding:6px 10px; border:1px solid #eceff5; border-radius:9999px;
  background:#fafbff; font-size:13px; margin-right:6px
}
.chips .chip.stat{ background:#f5f1ff; border-color:#e7e2ff }

/* ===== Generic table base ===== */
table{ width:100%; border-collapse:separate; border-spacing:0 }
th,td{ padding:12px 10px; border-bottom:1px solid var(--border); text-align:left }
th{ font-size:12px; color:var(--muted); font-weight:800; letter-spacing:.2px }
tr:hover td{ background:#fbfdff }
.mono{ font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Monospace }
.level-dot{ display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:6px; vertical-align:middle }
.level-dot.ok{ background:var(--ok) } .level-dot.below{ background:var(--below) } .level-dot.over{ background:var(--over) }

/* ===== Panels ===== */
section.panel{ display:none }
section.panel.active{ display:block }

/* ===== Storage UI (Left list) ===== */
.app-storage{ display:grid; grid-template-columns:420px 1fr; gap:16px }
.room-grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:12px; align-content:start }
.room{
  background:var(--panel); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow);
  display:flex; flex-direction:column; overflow:hidden
}
.room header{
  display:flex; justify-content:space-between; align-items:center; gap:8px;
  padding:10px 12px; background:linear-gradient(#fff,#f7f9ff); border-bottom:1px solid var(--border); cursor:pointer
}
.room .bar{ display:flex; align-items:center; gap:10px; flex:1; min-width:0 }
.room .title{ font-weight:800; min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
.room .list{
  padding:10px; display:grid; gap:8px;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); align-content:start; max-height:56vh; overflow:auto
}
.room.active header{ background:linear-gradient(#fff,#f1f5ff); box-shadow:inset 0 0 0 2px rgba(37,99,235,.15) }

.storage-tile{
  position:relative; display:flex; flex-direction:column; gap:2px; align-items:flex-start;
  padding:10px 12px; background:#fff; border:1px solid #ecf0f8; border-radius:12px; min-height:56px;
  cursor:pointer; text-align:left
}
.storage-tile .name{ font-weight:800 }
.storage-tile .type{ font-size:11px; color:var(--muted) }
.storage-tile .count{
  position:absolute; right:8px; top:6px; font-size:11px; padding:2px 6px;
  border:1px solid var(--accent-200); border-radius:999px
}
.storage-tile.active{ outline:2px solid rgba(37,99,235,.25) }
.storage-tile.selected{ outline:3px solid rgba(239,68,68,.25) }

.add-storage{ padding:10px 12px; border:1px dashed #cfd4dc; border-radius:12px; background:#fff; cursor:pointer }
.add-storage:hover{ background:#fbfdff }

/* ===== Storage Map Toolbar Bits ===== */
.sm-toolbar .toolbar{ display:flex; gap:12px; align-items:center; flex-wrap:wrap }
.sm-toolbar .toolbar .search{
  display:flex; align-items:center; gap:8px; padding:10px 14px; border:1px solid #e6e8f0; border-radius:9999px; background:#fff
}
.sm-toolbar .toolbar .search input{ border:none; outline:none; width:100%; background:transparent; font-size:14px }

/* ===== Right Detail / Bands ===== */
.detail{
  position:sticky; top:0; height:100%;
  border:1px solid var(--border); background:linear-gradient(180deg,#fcfdff,#f6f8ff);
  display:flex; flex-direction:column; border-radius:14px; overflow:hidden
}
.detail header{ padding:12px 16px; border-bottom:1px solid var(--border); background:var(--panel); display:flex; align-items:center; justify-content:space-between; gap:8px }
.detail .title{ font-weight:900; font-size:18px }
.detail .subtitle{ color:#64748b; font-size:12px }
.detail .body{ padding:14px 16px; overflow:auto; display:flex; flex-direction:column; gap:12px }

/* ===== Drawer/Unplaced Bands ===== */
.band{
  border:1px solid var(--border); border-radius:12px; padding:10px 12px; font-weight:900;
  display:grid; grid-template-columns:72px 1fr auto; align-items:center
}
.band.unplaced{
  grid-template-columns:1fr; justify-items:center;
  background:#ff8a1f; color:#fff; border-color:#ff8a1f; letter-spacing:.5px
}
.band.drawer{ background:#d9f99d; border-color:#bbf7d0; color:#0f172a }
.band.drawer.active{ box-shadow:0 0 0 3px rgba(37,99,235,.18) inset }
.band-left{ font-size:20px }
.band-mid{ font-size:12px; color:#334155; font-weight:700 }
.band-right .mini-pill{ border:1px solid #e6e8f0; background:#fff; border-radius:9999px; padding:2px }
.mini-pill button{ border:0; background:transparent; padding:4px 8px; cursor:pointer }
.mini-pill span{ display:inline-block; min-width:24px; text-align:center; font-weight:800 }

/* ===== Drawer with partitions ===== */
.drawer-section{ display:flex; flex-direction:column; gap:10px }
.partitions{
  display:grid;
  grid-template-columns:repeat(var(--cols, 1), minmax(180px,1fr));
  gap:10px; align-items:start
}
.part-col{ display:flex; flex-direction:column; gap:6px; min-width:0 }
.part-cap{
  font-size:12px; color:#64748b; font-weight:800; letter-spacing:.2px;
  padding:4px 8px; border:1px solid var(--border); border-radius:999px; width:max-content
}
.part-drop{
  border:1px dashed #d8e1f2; border-radius:12px; background:#fff; padding:8px; min-height:120px;
  display:grid; grid-template-columns:repeat(auto-fill, minmax(220px, 1fr)); gap:8px; align-content:start
}

/* ===== Unplaced drop ===== */
.unplaced-drop{
  border:1px dashed #d8e1f2; border-radius:12px; background:#fff; padding:8px; min-height:120px;
  display:grid; grid-template-columns:repeat(auto-fill, minmax(220px, 1fr)); gap:8px; align-content:start; margin-top:8px;
}

/* ===== Item tiles ===== */
.item-card{
  position:relative; border:1px solid var(--border); border-radius:12px; background:#fff;
  padding:10px; cursor:grab; width:100%; display:flex; flex-direction:column; gap:8px; min-height:78px
}
.item-card .ic-name{
  font-weight:800; font-size:13px; line-height:1.25;
  display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;
  overflow:hidden; white-space:normal
}
.item-card .ic-meta{ display:flex; justify-content:space-between; align-items:center; font-size:12px; color:#1f2937; gap:10px }
.item-card.is-selected{ outline:3px solid rgba(37,99,235,.28) }

/* tile tint by type */
.item-card.type-consumable{      background:#E1ECFF; border-color:#BBD2FF }
.item-card.type-instrument_tray{ background:#E8E6FF; border-color:#D3CEFF }
.item-card.type-single_pack{     background:#FFE0E7; border-color:#FFC2CE }
.item-card.type-implant{         background:#EEE6FF; border-color:#D7C8FF }
.item-card.type-medical_device{  background:#DDF1EB; border-color:#B7E4D7 }
.item-card.type-table_attach{    background:#FFE7CC; border-color:#FFD3A3 }

/* === Tri-panel layout =================================================== */
.tri-wrap{
  --leftW: 300px;
  --midW: 520px;
  display:grid;
  grid-template-columns: var(--leftW) 6px var(--midW) 6px 1fr;
  gap:0;
  height: calc(100vh - 84px);
}
.tri-col{ overflow:auto; padding:8px 10px 14px 10px }
.tri-left, .tri-mid, .tri-right{ background:transparent }

/* vertical splitters */
.v-sizer{
  cursor: col-resize;
  background: linear-gradient(180deg,#ffffff,#f4f6fb);
  border-left:1px solid var(--border); border-right:1px solid var(--border);
}
.v-sizer:hover{ background:#eaf1ff }

/* ===== Right panel bits ===== */
.loc-banner{
  background:#d9f99d; border:1px solid #bbf7d0; border-radius:12px;
  padding:10px 12px; margin-bottom:10px; color:#0f172a;
}
.loc-title{ font-weight:900; font-size:18px; line-height:1.25; word-break:break-word; white-space:normal; }
.loc-help{ margin-top:4px; font-size:12px; color:#334155; font-weight:700; line-height:1.2; }

.storage-col{ min-width:0 }
.storage-bar{
  background:#3b4252; color:#fff; border-radius:10px; padding:10px 12px;
  display:flex; align-items:center; gap:8px;
}
.storage-bar .name{ font-weight:900 }
.storage-bar .meta{ font-size:12px; opacity:.9 }

.detail-body{ padding:10px 2px 2px 2px; display:flex; flex-direction:column; gap:12px }

/* drawer section */
.drawer-section{ display:flex; flex-direction:column; gap:8px }
.drawer-row{ display:grid; grid-template-columns:auto 1fr; gap:10px; align-items:start }
.drawer-label{
  background:#fff; border:1px solid var(--border); border-radius:999px;
  padding:8px 12px; font-weight:800; display:inline-flex; align-items:center; gap:8px
}
.drawer-label.clickable{ cursor:pointer }
.part-controls{ display:inline-flex; align-items:center; gap:6px }
.part-controls .mini.icon{ padding:0 8px; height:22px; line-height:22px; border-radius:8px }
.part-count{ font-size:12px; color:#64748b; font-weight:800 }

/* ===== Desktop (unchanged) ===== */
.tri-wrap.desktop { display:grid; grid-template-columns: var(--leftW) 6px var(--midW) 6px 1fr; gap:0; height:100%; min-height:0; }
.tri-col { min-width:0; }

/* ===== Mobile: stack columns, sticky helpers ===== */
@media (max-width: 900px) {
  .tri-wrap.mobile { display:block; }
  .v-sizer { display:none !important; }

  .tri-col { padding:8px 10px; }
  .tri-left, .tri-mid, .tri-right { margin-bottom:8px; }

  .loc-banner, .storage-bar, .sm-toolbar {
    position:sticky; top:0; z-index:10; background:#fff;
  }
  .loc-banner { top:0; padding:8px 10px; }
  .storage-bar { top:44px; padding:8px 10px; }
  .sm-toolbar  { top:0; padding:6px 8px; }

  .storage-tile, .item-card { padding:12px 14px; border-radius:14px; }
  .sm-toolbar .search input { width:100%; font-size:16px; padding:10px 12px; }

  .drawer-row .partitions {
    display:grid !important;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap:8px;
  }
  .drawer-row .part-col { min-width:0; }
  .drawer-row .part-cap { font-size:12px; color:#64748b; margin-bottom:6px; }
  .part-drop {
    min-height:80px; padding:8px; border-radius:12px;
    border:1px dashed #cbd5e1; background:#f8fafc;
  }

  .drawer-label {
    display:flex; align-items:center; justify-content:space-between;
    gap:10px; padding:8px 10px; border-radius:10px; background:#f1f5f9; margin-bottom:6px;
  }
  .drawer-label .part-controls { display:inline-flex; align-items:center; gap:8px; }
  .drawer-label .part-count { min-width:28px; text-align:center; font-weight:700; }
  .drawer-label button.mini.icon { padding:6px 10px; line-height:1; border:1px solid #e2e8f0; border-radius:8px; }

  .storage-bar { display:flex; gap:8px; flex-wrap:wrap; }
  .storage-bar .name { font-size:16px; }
  .storage-bar .meta { font-size:12px; }
  .storage-bar button.mini { padding:8px 10px; }

  .tri-right .detail-body { max-height:none !important; }
  .unplaced-drop { display:grid; grid-template-columns:1fr; gap:8px; }
}

@media (max-width: 480px) {
  .drawer-row .partitions { grid-template-columns: 1fr 1fr; }
}

/* ======== NEW: Mobile tabs (Locations / Unplaced / Storages) ======== */
.mobile-tabs{
  position:sticky; top:0; z-index:11;
  display:grid; grid-template-columns:repeat(3,1fr); gap:6px;
  padding:8px 10px; background:#fff; border-bottom:1px solid var(--border);
}
.mobile-tabs button{
  appearance:none; border:1px solid #e6e8f0; background:#f4f6fb; color:#0f172a;
  border-radius:9999px; padding:10px 12px; font-weight:700; font-size:14px; cursor:pointer;
}
.mobile-tabs button.on{
  background:linear-gradient(90deg,#662D91,#F15A29); color:#fff; border-color:transparent;
  box-shadow:0 4px 12px rgba(101,45,145,.25);
}

/* ======== NEW: Tap-to-assign bottom sheet ======== */
.sheet-backdrop{
  position:fixed; inset:0; background:rgba(2,6,23,.35); z-index:50;
  display:flex; align-items:flex-end;
}
.sheet{
  width:100%; background:#fff; border-radius:16px 16px 0 0;
  box-shadow:0 -12px 40px rgba(0,0,0,.25);
  padding:14px 16px 16px; max-height:85vh; overflow:auto;
  animation:sheetRise .18s ease-out;
}
@keyframes sheetRise { from{ transform:translateY(12px); opacity:.9 } to{ transform:translateY(0); opacity:1 } }
.sheet-head{ margin-bottom:10px }
.sheet-title{ font-weight:900; font-size:18px }
.sheet-sub{ color:#475569; font-size:12px }
.sheet-actions{ display:flex; justify-content:flex-end; gap:8px; margin-top:12px }
